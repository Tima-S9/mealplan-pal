{% extends "base.html" %}
{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-lg border-0">
        <div class="card-body p-4">
          <h2 class="card-title mb-4 text-center">
            {% if recipe %}<i class="bi bi-pencil-square"></i> Edit Recipe{% else %}<i class="bi bi-plus-circle"></i> Create Recipe{% endif %}
          </h2>
          <ul class="nav nav-tabs mb-3" id="recipeTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="true">Details</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="ingredients-tab" data-bs-toggle="tab" data-bs-target="#ingredients" type="button" role="tab" aria-controls="ingredients" aria-selected="false">Ingredients</button>
            </li>
          </ul>
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="tab-content" id="recipeTabContent">
              <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
                <div class="mb-3">
                  <label for="id_title" class="form-label"><i class="bi bi-card-text"></i> Title</label>
                  {{ form.title }}
                </div>
                <div class="mb-3">
                  <label for="id_description" class="form-label"><i class="bi bi-align-left"></i> Description</label>
                  {{ form.description }}
                </div>
                <div class="mb-3">
                  <label for="id_image" class="form-label"><i class="bi bi-image"></i> Image</label>
                  {{ form.image }}
                </div>
                <div class="mb-3">
                  <label for="id_is_public" class="form-label"><i class="bi bi-globe"></i> Public</label>
                  {{ form.is_public }}
                </div>
                {% if form.calories %}
                <div class="mb-3">
                  <label for="id_calories" class="form-label"><i class="bi bi-fire"></i> Calories</label>
                  {{ form.calories }}
                </div>
                {% endif %}
              </div>
              <div class="tab-pane fade" id="ingredients" role="tabpanel" aria-labelledby="ingredients-tab">
                <div class="border rounded p-3 bg-light mb-3">
                  <h5 class="mb-3"><i class="bi bi-list-check"></i> Ingredients Checklist</h5>
                  <div class="row">
                    {% for ingredient in form.ingredients.field.queryset %}
                      <div class="col-md-6 mb-2">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="ingredients" value="{{ ingredient.pk }}" id="ingredient{{ ingredient.pk }}"
                            {% if ingredient in form.initial.ingredients %}checked{% endif %}>
                          <label class="form-check-label" for="ingredient{{ ingredient.pk }}">
                            {{ ingredient.name }} <span class="badge bg-secondary ms-1">{{ ingredient.unit }}</span>
                          </label>
                        </div>
                      </div>
                    {% endfor %}
                  </div>
                </div>
                <div class="border rounded p-3 bg-white mb-3">
                  <h6 class="mb-2"><i class="bi bi-plus-circle"></i> Add a missing ingredient</h6>
                  <div class="input-group mb-2">
                    <input type="text" class="form-control" name="new_ingredient" placeholder="Enter new ingredient name">
                    <input type="text" class="form-control" name="new_ingredient_unit" placeholder="Unit (e.g. g, pcs)">
                  </div>
                  <small class="text-muted">If your ingredient is not listed, add it here and it will be included in your recipe.</small>
                </div>
              </div>
            </div>
            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-primary btn-lg">{% if recipe %}Update Recipe{% else %}Create Recipe{% endif %}</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<script>
  var triggerTabList = [].slice.call(document.querySelectorAll('#recipeTab button'));
  triggerTabList.forEach(function (triggerEl) {
    var tabTrigger = new bootstrap.Tab(triggerEl);
    triggerEl.addEventListener('click', function (event) {
      event.preventDefault();
      tabTrigger.show();
    });
  });
</script>
{% endblock %}
